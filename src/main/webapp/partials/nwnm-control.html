<div x-ng-controller="NWNMControl">
	<div e-left-bar accordion close-others="true" class="controlPanel2">
		<div accordion-group heading="Warning Regions" x-ng-if="regions && regions.length > 1">
			<table class="table">
				<tr x-ng-repeat="region in regions" class="e-iceprovider">
					<td><input type="checkbox" x-ng-change="showMsi()" x-ng-model="region.selected" name="regions"
						id="region_{{$index}}" /></td>
					<td><label for="region_{{$index}}">{{region.description}}</label></td>
					<td><label for="region_{{$index}}">({{region.name}})</label></td>
				</tr>
			</table>
		</div>
		<div accordion-group heading="Active Warnings" e-left-bar-open-on-init>
			<div x-ng-if="!warnings || warnings.length === 0">No active warnings</div>
			<table class="table table-condensed" x-ng-if="warnings">
				<tr>
					<th>Date</th>
					<th>Type</th>
					<th>Area</th>
				</tr>
				<tr x-ng-repeat="warning in warnings" style='cursor: pointer' x-ng-click="selectMsi(warning)">
					<td>{{formatDate(warning.created)}}</td>
					<td>{{warning.enctext}}</td>
					<td>{{warning.areaHeading}}</td>
				</tr>
			</table>
		</div>
		<div accordion-group heading="Selected Warning" is-open="selected.open" e-left-bar-content-change="{{selected.msi}}">
			<p>{{selected.msi.enctext}}</p>
			<table class="table table-condensed" x-ng-if="selected.msi">
                <!-- Reference lines -->
                <tr ng-if="selected.msi.references && selected.msi.references.length > 0">
                    <th>References</th>
                    <td>
                        <div ng-repeat="ref in selected.msi.references">
                            <span>{{ref.messageId}}</span>
                            <span ng-switch="ref.type">
                                    <span ng-switch-when="REPETITION">(repetition)</span>
                                    <span ng-switch-when="REPETITION_NEW_TIME">(repetition with new time)</span>
                                    <span ng-switch-when="CANCELLATION">(cancellation)</span>
                                    <span ng-switch-when="UPDATE">(updated repetition)</span>
                                </span>
                            <span ng-if="ref.descs && ref.descs.length > 0 && ref.descs[0].description">
                                    - {{ref.descs[0].description}}
                                </span>
                        </div>
                    </td>
                </tr>

                <!-- Details line -->
                <tr ng-if="selected.msi.parts" ng-repeat="part in selected.msi.parts">
                    <th>
                            <span ng-if="$index == 0 || selected.msi.parts[$index].type != selected.msi.parts[$index - 1].type">
                                {{part.type.toLowerCase()}}
                            </span>
                    </th>
                    <td class="message-description">
                        <div ng-if="part.descs">
                            <p ng-if="part.descs[0].subject"><strong>{{part.descs[0].subject}}</strong></p>
                            <div ng-if="part.descs[0].details" ng-bind-html="part.descs[0].details | toTrusted"></div>
                        </div>
                    </td>
                </tr>

                <!-- Charts line -->
                <tr ng-if="selected.msi.charts.length > 0">
                    <th>Charts</th>
                    <td>
                            <span ng-repeat="chart in selected.msi.charts">
                                <span ng-if="!$first">, </span>
                                {{chart.chartNumber}}
                                <span ng-if="chart.internationalNumber">(INT {{chart.internationalNumber}})</span>
                            </span>
                    </td>
                </tr>

                <!-- Source line -->
                <tr ng-if="selected.msi.descs[0].source">
                    <td colspan="2" class="text-right">({{selected.msi.descs[0].source}})</td>
                </tr>


			</table>
		</div>
		<div accordion-group heading="Legends">
			<table class="table table-condensed">
				<tr>
					<td style="vertical-align: middle;"><img src="img/nwnm/nm.png" style="width: 24px; height: 24px"></td>
					<td style="vertical-align: middle;">Notices to Mariners</td>
				</tr>
				<tr>
					<td style="vertical-align: middle;"><img src="img/nwnm/nw.png" style="width: 24px; height: 24px"></td>
					<td style="vertical-align: middle;">Navigational Warnings</td>
				</tr>
			</table>
		</div>
	</div>
</div>